<!doctype html>
<html>
	<head>
		<link rel="shortcut icon" href="/favicon.ico?v=3" />
        <title>WebSync</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<%= stylesheet_tag 'default' %>
        <%= javascript_tag 'bundle-norm' %>
        <% if defined?(@edit)&&@edit %>
            <script type="text/javascript">
            // Variable: object WebSyncAuth;
            // This is an internal object used for authenticating the websocket connection.
            WebSyncAuth = {
                // Variable: int WebSyncAuth.id;
                // This is the websocket connection id. Each connection has a unique id.
                id:"<%= @client_id %>",
                // Variable: int WebSyncAuth.key;
                // This is a randomly generated string used as an API key.
                key:"<%= @client_key %>",
                view_op: "<%= params[:op] %>",
                websocket_port: <%= $config['websocket']['port'] %>,
                websocket_url: "<%= $config['websocket']['url'] %>"
            }
            // Variable: object WebSyncData;
            // This contains the data for the document. This is automatically synced with the server.
            WebSyncData = <%= MultiJson.dump(@doc.body) %>;

            // Set document title.
            document.title = <%= @doc.name.inspect %> + " - WebSync";
            </script>
            <%= javascript_tag 'bundle-edit' %>
        <% end %>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-41779193-1', 'websyn.ca');
          ga('send', 'pageview');

        </script>
	</head>
	<body class="<%= params[:op] %>">
        <% if !(defined?(@no_menu)&&@no_menu) %>
<div class="menu">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container-fluid">
				<a class="brand" href="/" data-toggle="tooltip" title="Produced by Outer Earth Interactive" data-placement="bottom">WebSync</a>
                <ul class="nav">
                    <li class="text hidden-phone">is a document editing tool similar to Google Drive or Microsoft Skydrive. </li>
                </ul>
                <ul id="settings" class="nav pull-right ribbon-opt">
                    <li>
                        <a href="/upload" title="Upload"><i class="icon-large icon-cloud-upload"></i></a>
                    </li>
                    <% if admin? %>
                        <li>
                            <a href="/admin" title="Admin Control Panel"><i class="icon-cog icon-large"></i></a>
                        </li>
                    <% end %>
                    <li>
                        <%= render_login_button %>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
        <% end %>
		<%= yield %>
	</body>
    <% if !defined?(@javascripts).nil? %>
        <% @javascripts.each do |script| %>
            <script type="text/javascript" src="<%= script %>"></script>
        <% end %>
    <% end %>
    <script type="text/javascript">
        $('[data-toggle="tooltip"]').tooltip();
    </script>
</html>
